---
title: Writing a recursive function in R
author: ''
date: '2020-02-06'
slug: writing-a-recursive-function-in-r
categories: []
tags: []
---

## Background

Recursion has been a topic I've *heard* about, and even [*read* about it](https://adv-r.hadley.nz/expressions.html#ast-funs), but have never used. Recently, I was analyzing data for the Next Generation Science Standards hashtag on Twitter, and was puzzled to find that some of the Tweets I had accessed were replies to Tweets which were themselves not in the data set. 

Fortunately, the rtweet package returns data on which Tweet a reply is to; using these, it is possible (using rtweet) to access the original Tweet.

But, this raises an issue: What if the Tweet a reply is to is itself a reply (to another Tweet)? This problem starts to become a little complex. The solution I had tried was to use a [while loop](https://r4ds.had.co.nz/iteration.html); this worked basically fine, but I sensed there might be a better way. I talked this through with a student, and decided to see whether I could get it to work this way. 

This post represents my attempt to write *a recursive function* - one that involves calling itself. 

First, let's access the data. I use rtweet to access 10,000 recent Tweets with the #rstats hashtag. 

```{r}
library(rtweet)

d <- search_tweets("#rstats", n = 5000)
```

From these Tweets, there appear to be `r length(d$reply_to_status_id)` Tweets that are replies.

## Writing a recursive function

Here is my attempt at writing a recursive function; it takes one argument, `statuses`, which is the status ids for the Tweets a reply is to; the `reply_to_status_id` column in the data collected from rtweet.

```{r}
get_replies_recursive <- function(statuses) {
  statuses <- statuses[!is.na(statuses)] # this line removes the NAs, which are very common because most Tweets are not replies
  new_data <- lookup_statuses(statuses)
  
  print(paste0("Accessed ", nrow(new_data), " new Tweets"))
  
  new_statuses <- new_data$reply_to_status_id[!is.na(new_data$reply_to_status_id)]

  if (length(new_statuses) > 0) {
    new_data_recursive <- get_replies_recursive(new_statuses) # this is the key line where the function calls itself, but passing different statuses
    out_data <- rbind(new_data, new_data_recursive)
  } else {
    print(paste0("Accessed ", nrow(new_data), " new Tweets in total"))
    return(new_data)
  }
}
```

## Using the function

Using it is simple; you just pass the variable for the status ids for the Tweets a reply is to.

```{r}
new_replies <- get_replies_recursive(d$reply_to_status_id)
```

## *fin*

I'm unsure exactly how much more better (clear, efficient) using recursion is here, compared to the former approach I tried; I think this code is a bit simpler. I am also unsure how generally useful reecursion is in real-life programming. Lastly, I'm not sure I did this quite right! But, this seemed to work, and I welcome any feedback about it!